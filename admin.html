<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kifkif-Fit Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2189a0;
            --primary-hover: #1a6d7a;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #f9fafb;
            --surface: #ffffff;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-logo {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
            font-size: 24px;
            font-weight: 600;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 0;
        }

        .sidebar-menu a {
            display: block;
            padding: 12px 1.5rem;
            color: white;
            text-decoration: none;
            transition: background 0.2s;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(255,255,255,0.1);
            border-left-color: white;
        }

        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 2rem;
        }

        .header {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .logout-btn {
            background: var(--error);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .logout-btn:hover {
            opacity: 0.9;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }

        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: auto;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--bg);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: var(--bg);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .stock-low {
            color: var(--error);
            font-weight: 600;
        }

        .stock-ok {
            color: var(--success);
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            opacity: 0.9;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-250px);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-logo">Kifkif-Fit Admin</div>
            <ul class="sidebar-menu">
                <li><a class="menu-link active" data-section="dashboard">üìä Dashboard</a></li>
                <li><a class="menu-link" data-section="orders">üì¶ Orders</a></li>
                <li><a class="menu-link" data-section="customers">üë• Customers</a></li>
                <li><a class="menu-link" data-section="inventory">üìã Inventory</a></li>
                <li><a class="menu-link" data-section="products">üõçÔ∏è Products</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="header">
                <h1>Admin Panel</h1>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <section id="dashboard" class="content-section active">
                <h2 style="margin-bottom: 1.5rem;">Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="value" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #f59e0b;">
                        <h3>Pending Orders</h3>
                        <div class="value" style="color: #f59e0b;" id="pendingOrders">0</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #22c55e;">
                        <h3>Total Customers</h3>
                        <div class="value" style="color: #22c55e;" id="totalCustomers">0</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #ef4444;">
                        <h3>Low Stock Items</h3>
                        <div class="value" style="color: #ef4444;" id="lowStockItems">0</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="padding: 1rem;">Recent Orders</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrdersTable">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="orders" class="content-section">
                <h2 style="margin-bottom: 1.5rem;">Orders Management</h2>
                
                <div class="filters">
                    <input type="text" class="search-input" id="ordersSearch" placeholder="Search by Order ID or Customer...">
                    <select id="statusFilter" style="padding: 10px; border: 1px solid var(--border); border-radius: 4px;">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="customers" class="content-section">
                <h2 style="margin-bottom: 1.5rem;">Customers Management</h2>
                
                <div class="filters">
                    <input type="text" class="search-input" id="customersSearch" placeholder="Search by Name or Email...">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Orders</th>
                                <th>Total Spent</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customersTable">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="inventory" class="content-section">
                <h2 style="margin-bottom: 1.5rem;">Inventory Management</h2>
                
                <div class="filters">
                    <input type="text" class="search-input" id="inventorySearch" placeholder="Search by Product...">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="products" class="content-section">
                <h2 style="margin-bottom: 1.5rem;">Products Management</h2>
                
                <button class="btn btn-primary" onclick="openAddProductModal()" style="margin-bottom: 1.5rem;">+ Add Product</button>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Price (DT)</th>
                                <th>Size</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Order Details</h2>
                <button class="close-btn" onclick="closeOrderModal()">√ó</button>
            </div>
            <div id="orderDetailContent"></div>
        </div>
    </div>

    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Customer Details</h2>
                <button class="close-btn" onclick="closeCustomerModal()">√ó</button>
            </div>
            <div id="customerDetailContent"></div>
        </div>
    </div>

    <div class="modal" id="stockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Stock</h2>
                <button class="close-btn" onclick="closeStockModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Product</label>
                <input type="text" id="stockProductName" readonly style="background: var(--bg);">
            </div>
            <div class="form-group">
                <label>Current Stock</label>
                <input type="number" id="currentStock" readonly style="background: var(--bg);">
            </div>
            <div class="form-group">
                <label>New Stock</label>
                <input type="number" id="newStock" min="0">
            </div>
            <button class="btn btn-success" onclick="saveStock()">Update</button>
        </div>
    </div>

    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Product</h2>
                <button class="close-btn" onclick="closeAddProductModal()">√ó</button>
            </div>
            <form onsubmit="addProduct(event)">
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="productCategory" required>
                        <option value="">Select Category</option>
                        <option value="tops">Tops</option>
                        <option value="bottoms">Bottoms</option>
                        <option value="accessories">Accessories</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price (DT)</label>
                    <input type="number" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Size</label>
                    <input type="text" id="productSize" placeholder="e.g., XS-XL or One Size" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="productDescription" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">Add Product</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- Firebase Config & Data Manager -->
<script>
// Initialize Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDo31itQ28m6E_egsOg0oX3yzBbTj3PIBE",
  authDomain: "kifkif-fit-ec202.firebaseapp.com",
  projectId: "kifkif-fit-ec202",
  storageBucket: "kifkif-fit-ec202.firebasestorage.app",
  messagingSenderId: "123273575250",
  appId: "1:123273575250:web:584960a820a58f0059d88b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Firebase Data Manager (replaces data-manager.js)
const dataManager = {
    getProducts: function() {
        // This will be loaded asynchronously - see below
        return window.productsCache || [];
    },
    
    getOrders: function() {
        return window.ordersCache || [];
    },
    
    getCustomers: function() {
        return window.customersCache || [];
    },
    
    getInventory: function() {
        const products = this.getProducts();
        return products.map(p => ({
            id: p.id,
            name: p.name,
            category: p.category,
            price: p.price,
            stock: p.stock || 50
        }));
    },
    
    addOrder: function(order) {
        const orderId = 'KF' + Date.now();
        const orderData = {
            ...order,
            id: orderId,
            status: 'pending',
            date: new Date().toLocaleString('en-GB')
        };
        
        // Save to Firebase
        db.collection('orders').doc(orderId).set(orderData);
        
        // Update stock for each item
        order.items.forEach(item => {
            const productRef = db.collection('products').doc(item.id.toString());
            productRef.get().then(doc => {
                if (doc.exists) {
                    const currentStock = doc.data().stock || 50;
                    productRef.update({
                        stock: Math.max(0, currentStock - item.quantity)
                    });
                }
            });
        });
        
        return orderData;
    },
    
    updateStock: function(productId, newStock) {
        db.collection('products').doc(productId.toString()).update({
            stock: newStock
        });
    },
    
    updateOrderStatus: function(orderId, status) {
        db.collection('orders').doc(orderId).update({
            status: status
        });
    },
    
    addProduct: function(product) {
        const productId = Date.now();
        const productData = {
            id: productId,
            ...product,
            stock: 50,
            emoji: 'üëï',
            color: '#667eea'
        };
        
        db.collection('products').doc(productId.toString()).set(productData);
        return productData;
    },
    
    deleteProduct: function(productId) {
        db.collection('products').doc(productId.toString()).delete();
    }
};

// Initialize default products if none exist
db.collection('products').get().then(snapshot => {
    if (snapshot.empty) {
        console.log('Initializing default products...');
        const defaultProducts = [
            { id: 1, name: 'Performance Tank', category: 'tops', price: 45.99, size: 'XS-XL', description: 'Breathable mesh tank top', emoji: 'üëï', color: '#667eea', stock: 50 },
            { id: 2, name: 'Compression Shorts', category: 'bottoms', price: 55.99, size: 'XS-XL', description: 'High-performance compression', emoji: 'ü©≥', color: '#8b5cf6', stock: 50 },
            { id: 3, name: 'Training Joggers', category: 'bottoms', price: 65.99, size: 'XS-XL', description: 'Comfortable training pants', emoji: 'üëñ', color: '#06b6d4', stock: 50 },
            { id: 4, name: 'Sports Bra', category: 'tops', price: 39.99, size: 'XS-XL', description: 'High-support sports bra', emoji: 'üëô', color: '#ec4899', stock: 50 },
            { id: 5, name: 'Gym Bag', category: 'accessories', price: 75.99, size: 'One Size', description: 'Durable gym duffle bag', emoji: 'üéí', color: '#f59e0b', stock: 50 },
            { id: 6, name: 'Workout Gloves', category: 'accessories', price: 25.99, size: 'S-L', description: 'Padded lifting gloves', emoji: 'üß§', color: '#10b981', stock: 50 },
            { id: 7, name: 'Training Hoodie', category: 'tops', price: 85.99, size: 'XS-XL', description: 'Warm-up hoodie', emoji: 'üß•', color: '#3b82f6', stock: 50 },
            { id: 8, name: 'Resistance Bands', category: 'accessories', price: 35.99, size: 'One Size', description: 'Set of 5 resistance bands', emoji: 'üí™', color: '#ef4444', stock: 50 }
        ];
        
        defaultProducts.forEach(product => {
            db.collection('products').doc(product.id.toString()).set(product);
        });
    }
});

// Load products from Firebase
window.productsCache = [];
window.ordersCache = [];
window.customersCache = [];

db.collection('products').onSnapshot(snapshot => {
    window.productsCache = [];
    snapshot.forEach(doc => {
        window.productsCache.push(doc.data());
    });
    
    // Trigger products render if function exists
    if (typeof renderProducts === 'function') {
        renderProducts();
    }
});

db.collection('orders').onSnapshot(snapshot => {
    window.ordersCache = [];
    const customerMap = {};
    
    snapshot.forEach(doc => {
        const order = doc.data();
        window.ordersCache.push(order);
        
        // Build customers list
        if (!customerMap[order.email]) {
            customerMap[order.email] = {
                name: order.name,
                email: order.email,
                phone: order.phone,
                orderCount: 0,
                totalSpent: 0,
                lastOrder: order.date
            };
        }
        customerMap[order.email].orderCount++;
        customerMap[order.email].totalSpent += order.total;
    });
    
    window.customersCache = Object.values(customerMap);
    
    // Trigger admin renders if functions exist
    if (typeof updateDashboard === 'function') {
        updateDashboard();
    }
    if (typeof renderOrders === 'function') {
        renderOrders();
    }
    if (typeof renderCustomers === 'function') {
        renderCustomers();
    }
});
</script>

    <script>
        // Load persistent data from shared data manager
        let products = dataManager.getProducts();
        let orders = dataManager.getOrders();
        let customers = dataManager.getCustomers();
        let inventory = dataManager.getInventory();

        function updateDashboard() {
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
            document.getElementById('totalCustomers').textContent = customers.length;
            document.getElementById('lowStockItems').textContent = inventory.filter(i => i.stock < 10).length;
            renderRecentOrders();
        }

        function renderRecentOrders() {
            const tbody = document.getElementById('recentOrdersTable');
            tbody.innerHTML = orders.slice(-5).reverse().map(order => `
                <tr>
                    <td><strong>#${order.id}</strong></td>
                    <td>${order.name}</td>
                    <td>${order.total.toFixed(2)} DT</td>
                    <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                    <td>${order.date}</td>
                </tr>
            `).join('');
        }

        function renderOrders() {
            const tbody = document.getElementById('ordersTable');
            let filtered = orders;

            const search = document.getElementById('ordersSearch').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;

            if (search) filtered = filtered.filter(o => o.id.toLowerCase().includes(search) || o.name.toLowerCase().includes(search));
            if (status) filtered = filtered.filter(o => o.status === status);

            tbody.innerHTML = filtered.map(order => `
                <tr>
                    <td><strong>#${order.id}</strong></td>
                    <td>${order.name}</td>
                    <td>${order.items.length} items</td>
                    <td>${order.total.toFixed(2)} DT</td>
                    <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                    <td>${order.date}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="openOrderDetail('${order.id}')">View</button>
                            <select class="btn btn-sm" style="background: white; border: 1px solid var(--border); padding: 6px;" onchange="updateOrderStatus('${order.id}', this.value); this.value='';">
                                <option value="">Status</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderCustomers() {
            const tbody = document.getElementById('customersTable');
            let filtered = customers;

            const search = document.getElementById('customersSearch').value.toLowerCase();
            if (search) filtered = filtered.filter(c => c.name.toLowerCase().includes(search) || c.email.toLowerCase().includes(search));

            tbody.innerHTML = filtered.map(customer => `
                <tr>
                    <td>${customer.name}</td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.orderCount}</td>
                    <td>${customer.totalSpent.toFixed(2)} DT</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openCustomerDetail('${customer.email}')">View</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderInventory() {
            const tbody = document.getElementById('inventoryTable');
            let filtered = inventory;

            const search = document.getElementById('inventorySearch').value.toLowerCase();
            if (search) filtered = filtered.filter(i => i.name.toLowerCase().includes(search));

            tbody.innerHTML = filtered.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.price.toFixed(2)} DT</td>
                    <td>
                        <span class="${item.stock < 10 ? 'stock-low' : 'stock-ok'}">
                            ${item.stock} units
                        </span>
                    </td>
                    <td>
                        ${item.stock < 10 ? '<span class="status-badge" style="background: #fef3c7; color: #92400e;">Low Stock</span>' : '<span class="status-badge" style="background: #dcfce7; color: #166534;">In Stock</span>'}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openStockModal(${item.id})">Update Stock</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderProducts() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.price.toFixed(2)}</td>
                    <td>${product.size}</td>
                    <td>${product.stock}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        document.querySelectorAll('.menu-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const section = e.target.dataset.section;
                document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');

                if (section === 'orders') renderOrders();
                if (section === 'customers') renderCustomers();
                if (section === 'inventory') renderInventory();
                if (section === 'products') renderProducts();
            });
        });

        document.getElementById('ordersSearch').addEventListener('input', renderOrders);
        document.getElementById('statusFilter').addEventListener('change', renderOrders);
        document.getElementById('customersSearch').addEventListener('input', renderCustomers);
        document.getElementById('inventorySearch').addEventListener('input', renderInventory);

        function openOrderDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const content = document.getElementById('orderDetailContent');
            content.innerHTML = `
                <div style="line-height: 2;">
                    <p><strong>Order ID:</strong> #${order.id}</p>
                    <p><strong>Customer:</strong> ${order.name}</p>
                    <p><strong>Email:</strong> ${order.email}</p>
                    <p><strong>Phone:</strong> ${order.phone}</p>
                    <p><strong>Address:</strong> ${order.address}</p>
                    <p><strong>State:</strong> ${order.state}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${order.status}">${order.status}</span></p>
                    <p><strong>Date:</strong> ${order.date}</p>
                    <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border);">
                    <h4 style="margin-bottom: 0.5rem;">Items:</h4>
                    ${order.items.map(item => `<p style="margin: 0.25rem 0;">‚Ä¢ ${item.name} (${item.size}) x${item.quantity} - ${(item.price * item.quantity).toFixed(2)} DT</p>`).join('')}
                    <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border);">
                    <p><strong>Subtotal:</strong> ${order.subtotal.toFixed(2)} DT</p>
                    <p><strong>Delivery Fee:</strong> ${order.deliveryFee} DT</p>
                    <p style="font-size: 18px; color: var(--primary);"><strong>Total:</strong> ${order.total.toFixed(2)} DT</p>
                </div>
            `;
            document.getElementById('orderModal').classList.add('open');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('open');
        }

        function openCustomerDetail(email) {
            const customer = customers.find(c => c.email === email);
            if (!customer) return;

            const content = document.getElementById('customerDetailContent');
            content.innerHTML = `
                <div style="line-height: 2;">
                    <p><strong>Name:</strong> ${customer.name}</p>
                    <p><strong>Email:</strong> ${customer.email}</p>
                    <p><strong>Phone:</strong> ${customer.phone}</p>
                    <p><strong>Total Orders:</strong> ${customer.orderCount}</p>
                    <p><strong>Total Spent:</strong> ${customer.totalSpent.toFixed(2)} DT</p>
                    <p><strong>Last Order:</strong> ${customer.lastOrder || 'N/A'}</p>
                </div>
            `;
            document.getElementById('customerModal').classList.add('open');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('open');
        }

        let selectedStockItem = null;
        function openStockModal(productId) {
            selectedStockItem = inventory.find(i => i.id === productId);
            if (!selectedStockItem) return;

            document.getElementById('stockProductName').value = selectedStockItem.name;
            document.getElementById('currentStock').value = selectedStockItem.stock;
            document.getElementById('newStock').value = selectedStockItem.stock;
            document.getElementById('stockModal').classList.add('open');
        }

        function closeStockModal() {
            document.getElementById('stockModal').classList.remove('open');
        }

        function saveStock() {
            const newStock = parseInt(document.getElementById('newStock').value);
            if (isNaN(newStock) || newStock < 0) {
                alert('Please enter a valid stock number');
                return;
            }

            dataManager.updateStock(selectedStockItem.id, newStock);

            inventory = dataManager.getInventory();
            products = dataManager.getProducts();

            renderInventory();
            updateDashboard();
            closeStockModal();
            alert('Stock updated successfully!');
        }

        function openAddProductModal() {
            document.getElementById('addProductModal').classList.add('open');
        }

        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('open');
        }

        function addProduct(event) {
            event.preventDefault();

            const newProduct = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                size: document.getElementById('productSize').value,
                description: document.getElementById('productDescription').value
            };

            dataManager.addProduct(newProduct);

            products = dataManager.getProducts();
            inventory = dataManager.getInventory();

            renderProducts();
            closeAddProductModal();
            event.target.reset();
            alert('Product added successfully!');
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                dataManager.deleteProduct(productId);
                products = dataManager.getProducts();
                inventory = dataManager.getInventory();
                renderProducts();
                renderInventory();
                alert('Product deleted successfully!');
            }
        }

        function updateOrderStatus(orderId, status) {
            if (!status) return;
            dataManager.updateOrderStatus(orderId, status);
            orders = dataManager.getOrders();
            renderOrders();
            updateDashboard();
            alert(`Order status updated to ${status}!`);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                alert('Logged out successfully!');
                window.location.reload();
            }
        }

        updateDashboard();
    </script>
</body>
</html>
